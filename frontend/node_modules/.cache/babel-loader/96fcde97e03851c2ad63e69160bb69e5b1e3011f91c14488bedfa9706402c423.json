{"ast":null,"code":"import _regeneratorRuntime from \"/Users/guojingjing/2024-ai-code/crm/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/guojingjing/2024-ai-code/crm/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.object.define-property.js\";\nimport * as monaco from 'monaco-editor';\nimport { onMounted, onBeforeUnmount, watch, ref, nextTick } from 'vue';\nexport default {\n  __name: 'MonacoEditor',\n  props: {\n    modelValue: {\n      type: String,\n      \"default\": ''\n    },\n    language: {\n      type: String,\n      \"default\": 'javascript'\n    }\n  },\n  emits: ['update:modelValue'],\n  setup: function setup(__props, _ref) {\n    var __expose = _ref.expose,\n      __emit = _ref.emit;\n    __expose();\n    var props = __props;\n    var emit = __emit;\n    var editorContainer = ref(null);\n    var editor = null;\n    var initEditor = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var updateEditorLayout, resizeObserver;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return nextTick();\n            case 2:\n              if (editorContainer.value) {\n                _context.next = 4;\n                break;\n              }\n              return _context.abrupt(\"return\");\n            case 4:\n              // 销毁旧的编辑器实例\n              if (editor) {\n                editor.dispose();\n              }\n              editor = monaco.editor.create(editorContainer.value, {\n                value: props.modelValue,\n                language: props.language,\n                theme: 'vs-dark',\n                automaticLayout: false,\n                // 关闭自动布局\n                minimap: {\n                  enabled: false\n                },\n                scrollBeyondLastLine: false,\n                lineNumbers: 'on',\n                roundedSelection: false,\n                wordWrap: 'on'\n              });\n\n              // 手动处理布局更新\n              updateEditorLayout = function updateEditorLayout() {\n                if (editor) {\n                  editor.layout();\n                }\n              };\n              resizeObserver = new ResizeObserver(function () {\n                window.requestAnimationFrame(function () {\n                  updateEditorLayout();\n                });\n              });\n              resizeObserver.observe(editorContainer.value);\n              editor.onDidChangeModelContent(function () {\n                emit('update:modelValue', editor.getValue());\n              });\n\n              // 保存引用以便清理\n              editor._resizeObserver = resizeObserver;\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n      return function initEditor() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n    onMounted(function () {\n      initEditor();\n    });\n    onBeforeUnmount(function () {\n      if (editor) {\n        if (editor._resizeObserver) {\n          editor._resizeObserver.disconnect();\n        }\n        editor.dispose();\n      }\n    });\n    watch(function () {\n      return props.modelValue;\n    }, function (newValue) {\n      if (editor && newValue !== editor.getValue()) {\n        editor.setValue(newValue);\n      }\n    });\n    watch(function () {\n      return props.language;\n    }, function (newValue) {\n      if (editor) {\n        monaco.editor.setModelLanguage(editor.getModel(), newValue);\n      }\n    });\n    var __returned__ = {\n      props: props,\n      emit: emit,\n      editorContainer: editorContainer,\n      get editor() {\n        return editor;\n      },\n      set editor(v) {\n        editor = v;\n      },\n      initEditor: initEditor,\n      get monaco() {\n        return monaco;\n      },\n      onMounted: onMounted,\n      onBeforeUnmount: onBeforeUnmount,\n      watch: watch,\n      ref: ref,\n      nextTick: nextTick\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["monaco","onMounted","onBeforeUnmount","watch","ref","nextTick","props","__props","emit","__emit","editorContainer","editor","initEditor","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","updateEditorLayout","resizeObserver","wrap","_callee$","_context","prev","next","value","abrupt","dispose","create","modelValue","language","theme","automaticLayout","minimap","enabled","scrollBeyondLastLine","lineNumbers","roundedSelection","wordWrap","layout","ResizeObserver","window","requestAnimationFrame","observe","onDidChangeModelContent","getValue","_resizeObserver","stop","apply","arguments","disconnect","newValue","setValue","setModelLanguage","getModel"],"sources":["/Users/guojingjing/2024-ai-code/crm/frontend/src/components/MonacoEditor.vue"],"sourcesContent":["<template>\n  <div class=\"monaco-editor-wrapper\">\n    <div class=\"monaco-editor-container\" ref=\"editorContainer\"></div>\n  </div>\n</template>\n\n<script setup>\nimport * as monaco from 'monaco-editor'\nimport { onMounted, onBeforeUnmount, watch, ref, nextTick } from 'vue'\n\nconst props = defineProps({\n  modelValue: {\n    type: String,\n    default: ''\n  },\n  language: {\n    type: String,\n    default: 'javascript'\n  }\n})\n\nconst emit = defineEmits(['update:modelValue'])\nconst editorContainer = ref(null)\nlet editor = null\n\nconst initEditor = async () => {\n  await nextTick()\n  \n  if (!editorContainer.value) return\n  \n  // 销毁旧的编辑器实例\n  if (editor) {\n    editor.dispose()\n  }\n\n  editor = monaco.editor.create(editorContainer.value, {\n    value: props.modelValue,\n    language: props.language,\n    theme: 'vs-dark',\n    automaticLayout: false, // 关闭自动布局\n    minimap: { enabled: false },\n    scrollBeyondLastLine: false,\n    lineNumbers: 'on',\n    roundedSelection: false,\n    wordWrap: 'on'\n  })\n\n  // 手动处理布局更新\n  const updateEditorLayout = () => {\n    if (editor) {\n      editor.layout()\n    }\n  }\n\n  const resizeObserver = new ResizeObserver(() => {\n    window.requestAnimationFrame(() => {\n      updateEditorLayout()\n    })\n  })\n\n  resizeObserver.observe(editorContainer.value)\n\n  editor.onDidChangeModelContent(() => {\n    emit('update:modelValue', editor.getValue())\n  })\n\n  // 保存引用以便清理\n  editor._resizeObserver = resizeObserver\n}\n\nonMounted(() => {\n  initEditor()\n})\n\nonBeforeUnmount(() => {\n  if (editor) {\n    if (editor._resizeObserver) {\n      editor._resizeObserver.disconnect()\n    }\n    editor.dispose()\n  }\n})\n\nwatch(() => props.modelValue, (newValue) => {\n  if (editor && newValue !== editor.getValue()) {\n    editor.setValue(newValue)\n  }\n})\n\nwatch(() => props.language, (newValue) => {\n  if (editor) {\n    monaco.editor.setModelLanguage(editor.getModel(), newValue)\n  }\n})\n</script>\n\n<style>\n.monaco-editor-wrapper {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\n\n.monaco-editor-container {\n  width: 100%;\n  height: 100%;\n  border: 1px solid #dcdfe6;\n}\n\n/* 确保编辑器内容区域正确显示 */\n.monaco-editor {\n  padding: 8px;\n}\n\n/* 修复编辑器内容区域的样式 */\n.monaco-editor .overflow-guard {\n  width: 100% !important;\n  height: 100% !important;\n}\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}