{"ast":null,"code":"import \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/es.symbol.description.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, createTextVNode as _createTextVNode, createElementBlock as _createElementBlock } from \"vue\";\nvar _hoisted_1 = {\n  \"class\": \"strategy-edit\"\n};\nvar _hoisted_2 = {\n  \"class\": \"header\"\n};\nvar _hoisted_3 = {\n  \"class\": \"editor-wrapper\"\n};\nvar _hoisted_4 = {\n  \"class\": \"editor-tips\"\n};\nvar _hoisted_5 = {\n  \"class\": \"editor-wrapper\"\n};\nvar _hoisted_6 = {\n  \"class\": \"editor-tips\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  var _component_el_input = _resolveComponent(\"el-input\");\n  var _component_el_form_item = _resolveComponent(\"el-form-item\");\n  var _component_el_tag = _resolveComponent(\"el-tag\");\n  var _component_el_button = _resolveComponent(\"el-button\");\n  var _component_el_form = _resolveComponent(\"el-form\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"h2\", null, _toDisplayString($setup.isEdit ? '编辑策略' : '新建策略'), 1 /* TEXT */)]), _createVNode(_component_el_form, {\n    model: $setup.form,\n    \"label-width\": \"120px\",\n    rules: $setup.rules,\n    ref: \"formRef\"\n  }, {\n    \"default\": _withCtx(function () {\n      return [_createVNode(_component_el_form_item, {\n        label: \"策略名称\",\n        prop: \"name\"\n      }, {\n        \"default\": _withCtx(function () {\n          return [_createVNode(_component_el_input, {\n            modelValue: $setup.form.name,\n            \"onUpdate:modelValue\": _cache[0] || (_cache[0] = function ($event) {\n              return $setup.form.name = $event;\n            }),\n            placeholder: \"请输入策略名称\"\n          }, null, 8 /* PROPS */, [\"modelValue\"])];\n        }),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_form_item, {\n        label: \"策略描述\",\n        prop: \"description\"\n      }, {\n        \"default\": _withCtx(function () {\n          return [_createVNode(_component_el_input, {\n            modelValue: $setup.form.description,\n            \"onUpdate:modelValue\": _cache[1] || (_cache[1] = function ($event) {\n              return $setup.form.description = $event;\n            }),\n            type: \"textarea\",\n            placeholder: \"请输入策略描述\"\n          }, null, 8 /* PROPS */, [\"modelValue\"])];\n        }),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_form_item, {\n        label: \"SQL代码\",\n        prop: \"sql_code\",\n        \"class\": \"code-editor-item\"\n      }, {\n        \"default\": _withCtx(function () {\n          return [_createElementVNode(\"div\", _hoisted_3, [$setup.isDataReady ? (_openBlock(), _createBlock($setup[\"MonacoEditor\"], {\n            key: 0,\n            modelValue: $setup.form.sql_code,\n            \"onUpdate:modelValue\": _cache[2] || (_cache[2] = function ($event) {\n              return $setup.form.sql_code = $event;\n            }),\n            language: \"sql\"\n          }, null, 8 /* PROPS */, [\"modelValue\"])) : _createCommentVNode(\"v-if\", true)]), _createElementVNode(\"div\", _hoisted_4, [_createVNode(_component_el_tag, {\n            size: \"small\",\n            type: \"info\"\n          }, {\n            \"default\": _withCtx(function () {\n              return _cache[4] || (_cache[4] = [_createTextVNode(\"支持 SQL 代码提示\")]);\n            }),\n            _: 1 /* STABLE */\n          }), _createVNode(_component_el_button, {\n            size: \"small\",\n            type: \"primary\",\n            onClick: $setup.insertSqlTemplate\n          }, {\n            \"default\": _withCtx(function () {\n              return _cache[5] || (_cache[5] = [_createTextVNode(\"插入SQL模板\")]);\n            }),\n            _: 1 /* STABLE */\n          })])];\n        }),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_form_item, {\n        label: \"Python代码\",\n        prop: \"python_code\",\n        \"class\": \"code-editor-item\"\n      }, {\n        \"default\": _withCtx(function () {\n          return [_createElementVNode(\"div\", _hoisted_5, [$setup.isDataReady ? (_openBlock(), _createBlock($setup[\"MonacoEditor\"], {\n            key: 0,\n            modelValue: $setup.form.python_code,\n            \"onUpdate:modelValue\": _cache[3] || (_cache[3] = function ($event) {\n              return $setup.form.python_code = $event;\n            }),\n            language: \"python\"\n          }, null, 8 /* PROPS */, [\"modelValue\"])) : _createCommentVNode(\"v-if\", true)]), _createElementVNode(\"div\", _hoisted_6, [_createVNode(_component_el_tag, {\n            size: \"small\",\n            type: \"info\"\n          }, {\n            \"default\": _withCtx(function () {\n              return _cache[6] || (_cache[6] = [_createTextVNode(\"支持 Python 代码提示\")]);\n            }),\n            _: 1 /* STABLE */\n          }), _createVNode(_component_el_button, {\n            size: \"small\",\n            type: \"primary\",\n            onClick: $setup.insertPythonTemplate\n          }, {\n            \"default\": _withCtx(function () {\n              return _cache[7] || (_cache[7] = [_createTextVNode(\"插入Python模板\")]);\n            }),\n            _: 1 /* STABLE */\n          })])];\n        }),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_form_item, null, {\n        \"default\": _withCtx(function () {\n          return [_createVNode(_component_el_button, {\n            type: \"primary\",\n            onClick: $setup.handleSave\n          }, {\n            \"default\": _withCtx(function () {\n              return _cache[8] || (_cache[8] = [_createTextVNode(\"保存\")]);\n            }),\n            _: 1 /* STABLE */\n          }), _createVNode(_component_el_button, {\n            onClick: $setup.cancel\n          }, {\n            \"default\": _withCtx(function () {\n              return _cache[9] || (_cache[9] = [_createTextVNode(\"取消\")]);\n            }),\n            _: 1 /* STABLE */\n          })];\n        }),\n        _: 1 /* STABLE */\n      })];\n    }),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"model\"])]);\n}","map":{"version":3,"names":["_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_toDisplayString","$setup","isEdit","_createVNode","_component_el_form","model","form","rules","ref","_withCtx","_component_el_form_item","label","prop","_component_el_input","modelValue","name","_cache","$event","placeholder","_","description","type","_hoisted_3","isDataReady","_createBlock","key","sql_code","language","_createCommentVNode","_hoisted_4","_component_el_tag","size","_createTextVNode","_component_el_button","onClick","insertSqlTemplate","_hoisted_5","python_code","_hoisted_6","insertPythonTemplate","handleSave","cancel"],"sources":["/Users/guojingjing/2024-ai-code/crm/frontend/src/views/strategy/StrategyEdit.vue"],"sourcesContent":["<template>\n  <div class=\"strategy-edit\">\n    <div class=\"header\">\n      <h2>{{ isEdit ? '编辑策略' : '新建策略' }}</h2>\n    </div>\n    \n    <el-form :model=\"form\" label-width=\"120px\" :rules=\"rules\" ref=\"formRef\">\n      <el-form-item label=\"策略名称\" prop=\"name\">\n        <el-input v-model=\"form.name\" placeholder=\"请输入策略名称\" />\n      </el-form-item>\n      \n      <el-form-item label=\"策略描述\" prop=\"description\">\n        <el-input v-model=\"form.description\" type=\"textarea\" placeholder=\"请输入策略描述\" />\n      </el-form-item>\n      \n      <el-form-item label=\"SQL代码\" prop=\"sql_code\" class=\"code-editor-item\">\n        <div class=\"editor-wrapper\">\n          <MonacoEditor\n            v-if=\"isDataReady\"\n            v-model=\"form.sql_code\"\n            language=\"sql\"\n          />\n        </div>\n        <div class=\"editor-tips\">\n          <el-tag size=\"small\" type=\"info\">支持 SQL 代码提示</el-tag>\n          <el-button size=\"small\" type=\"primary\" @click=\"insertSqlTemplate\">插入SQL模板</el-button>\n        </div>\n      </el-form-item>\n      \n      <el-form-item label=\"Python代码\" prop=\"python_code\" class=\"code-editor-item\">\n        <div class=\"editor-wrapper\">\n          <MonacoEditor\n            v-if=\"isDataReady\"\n            v-model=\"form.python_code\"\n            language=\"python\"\n          />\n        </div>\n        <div class=\"editor-tips\">\n          <el-tag size=\"small\" type=\"info\">支持 Python 代码提示</el-tag>\n          <el-button size=\"small\" type=\"primary\" @click=\"insertPythonTemplate\">插入Python模板</el-button>\n        </div>\n      </el-form-item>\n      \n      <el-form-item>\n        <el-button type=\"primary\" @click=\"handleSave\">保存</el-button>\n        <el-button @click=\"cancel\">取消</el-button>\n      </el-form-item>\n    </el-form>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\nimport { ElMessage } from 'element-plus'\nimport MonacoEditor from '@/components/MonacoEditor.vue'\nimport { strategyApi } from '@/api/strategy'\n\nconst route = useRoute()\nconst router = useRouter()\nconst formRef = ref(null)\nconst isDataReady = ref(false)\n\nconst sqlTemplate = `-- 信贷风险评估SQL模板\nSELECT \n    customer_id,\n    credit_score,\n    loan_amount,\n    CASE \n        WHEN credit_score >= 700 THEN 'LOW'\n        WHEN credit_score >= 600 THEN 'MEDIUM'\n        ELSE 'HIGH'\n    END as risk_level\nFROM customer_credit_data\nWHERE application_date >= :start_date\n  AND application_date <= :end_date;`\n\nconst pythonTemplate = `# 信贷风险评估Python模板\ndef evaluate_credit_risk(data):\n    \"\"\"\n    评估信贷风险\n    :param data: 包含客户信息的字典\n    :return: 风险评估结果\n    \"\"\"\n    try:\n        # 提取关键指标\n        credit_score = data.get('credit_score', 0)\n        loan_amount = data.get('loan_amount', 0)\n        income = data.get('annual_income', 0)\n        \n        # 计算基础风险分数\n        risk_score = 0\n        \n        # 信用分数评估\n        if credit_score >= 700:\n            risk_score += 40\n        elif credit_score >= 600:\n            risk_score += 25\n        else:\n            risk_score += 10\n            \n        # 贷款金额与收入比评估\n        loan_to_income = loan_amount / income if income > 0 else float('inf')\n        if loan_to_income <= 0.3:\n            risk_score += 30\n        elif loan_to_income <= 0.5:\n            risk_score += 20\n        else:\n            risk_score += 10\n            \n        # 返回风险评估结果\n        return {\n            'risk_score': risk_score,\n            'risk_level': 'LOW' if risk_score >= 60 else 'MEDIUM' if risk_score >= 40 else 'HIGH',\n            'evaluation_factors': {\n                'credit_score': credit_score,\n                'loan_to_income_ratio': loan_to_income\n            }\n        }\n        \n    except Exception as e:\n        return {\n            'error': str(e),\n            'risk_level': 'ERROR'\n        }\n`\n\nconst form = ref({\n  name: '',\n  description: '',\n  sql_code: '',\n  python_code: ''\n})\n\nconst rules = {\n  name: [\n    { required: true, message: '请输入策略名称', trigger: 'blur' },\n    { min: 2, max: 50, message: '长度在 2 到 50 个字符', trigger: 'blur' }\n  ],\n  description: [\n    { required: true, message: '请输入策略描述', trigger: 'blur' }\n  ],\n  sql_code: [\n    { required: true, message: '请输入SQL代码', trigger: 'blur' }\n  ],\n  python_code: [\n    { required: true, message: '请输入Python代码', trigger: 'blur' }\n  ]\n}\n\nconst isEdit = computed(() => route.params.id !== undefined)\n\nconst insertSqlTemplate = () => {\n  form.value.sql_code = sqlTemplate\n}\n\nconst insertPythonTemplate = () => {\n  form.value.python_code = pythonTemplate\n}\n\nconst handleSave = async () => {\n  if (!formRef.value) return\n  \n  try {\n    await formRef.value.validate()\n    \n    if (isEdit.value) {\n      await strategyApi.updateStrategy(route.params.id, form.value)\n      ElMessage.success('策略更新成功')\n    } else {\n      await strategyApi.createStrategy(form.value)\n      ElMessage.success('策略创建成功')\n    }\n    \n    router.push('/strategy')\n  } catch (error) {\n    if (error.name === 'ValidationError') {\n      ElMessage.error('请检查表单填写是否正确')\n    } else {\n      ElMessage.error('保存失败：' + error.message)\n    }\n  }\n}\n\nconst cancel = () => {\n  router.push('/strategy')\n}\n\nconst loadStrategy = async () => {\n  if (!isEdit.value) {\n    isDataReady.value = true\n    return\n  }\n  \n  try {\n    const response = await strategyApi.getStrategy(route.params.id)\n    form.value = response.data\n    console.log('Strategy loaded:', form.value)\n    isDataReady.value = true\n  } catch (error) {\n    ElMessage.error('加载策略失败：' + error.message)\n    router.push('/strategy')\n  }\n}\n\nonMounted(async () => {\n  await loadStrategy()\n})\n</script>\n\n<style>\n.strategy-edit {\n  padding: 20px;\n}\n\n.header {\n  margin-bottom: 20px;\n}\n\n.code-editor-item {\n  margin-bottom: 22px;\n}\n\n.code-editor-item :deep(.el-form-item__content) {\n  height: auto;\n}\n\n.editor-wrapper {\n  height: 300px;\n  background-color: #1e1e1e;\n  border-radius: 4px;\n  overflow: hidden;\n}\n\n.editor-tips {\n  margin-top: 8px;\n  display: flex;\n  gap: 8px;\n  align-items: center;\n}\n\n.el-tag {\n  font-size: 12px;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}