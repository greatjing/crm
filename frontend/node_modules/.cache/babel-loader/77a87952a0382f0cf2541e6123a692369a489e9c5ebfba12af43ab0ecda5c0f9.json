{"ast":null,"code":"import _regeneratorRuntime from \"/Users/guojingjing/2024-ai-code/crm/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/guojingjing/2024-ai-code/crm/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.object.define-property.js\";\nimport { ref, computed, onMounted } from 'vue';\nimport { useRoute, useRouter } from 'vue-router';\nimport { ElMessage } from 'element-plus';\nimport MonacoEditor from '@/components/MonacoEditor.vue';\nimport { strategyApi } from '@/api/strategy';\nexport default {\n  __name: 'StrategyEdit',\n  setup: function setup(__props, _ref) {\n    var __expose = _ref.expose;\n    __expose();\n    var route = useRoute();\n    var router = useRouter();\n    var formRef = ref(null);\n    var form = ref({\n      name: '',\n      description: '',\n      sqlCode: '',\n      pythonCode: ''\n    });\n    var rules = {\n      name: [{\n        required: true,\n        message: '请输入策略名称',\n        trigger: 'blur'\n      }, {\n        min: 2,\n        max: 50,\n        message: '长度在 2 到 50 个字符',\n        trigger: 'blur'\n      }],\n      description: [{\n        required: true,\n        message: '请输入策略描述',\n        trigger: 'blur'\n      }],\n      sqlCode: [{\n        required: true,\n        message: '请输入SQL代码',\n        trigger: 'blur'\n      }],\n      pythonCode: [{\n        required: true,\n        message: '请输入Python代码',\n        trigger: 'blur'\n      }]\n    };\n    var isEdit = computed(function () {\n      return route.params.id !== undefined;\n    });\n    var handleSave = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              if (formRef.value) {\n                _context.next = 2;\n                break;\n              }\n              return _context.abrupt(\"return\");\n            case 2:\n              _context.prev = 2;\n              _context.next = 5;\n              return formRef.value.validate();\n            case 5:\n              if (!isEdit.value) {\n                _context.next = 11;\n                break;\n              }\n              _context.next = 8;\n              return strategyApi.updateStrategy(route.params.id, form.value);\n            case 8:\n              ElMessage.success('策略更新成功');\n              _context.next = 14;\n              break;\n            case 11:\n              _context.next = 13;\n              return strategyApi.createStrategy(form.value);\n            case 13:\n              ElMessage.success('策略创建成功');\n            case 14:\n              router.push('/strategy');\n              _context.next = 20;\n              break;\n            case 17:\n              _context.prev = 17;\n              _context.t0 = _context[\"catch\"](2);\n              if (_context.t0.name === 'ValidationError') {\n                ElMessage.error('请检查表单填写是否正确');\n              } else {\n                ElMessage.error('保存失败：' + _context.t0.message);\n              }\n            case 20:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, null, [[2, 17]]);\n      }));\n      return function handleSave() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n    var cancel = function cancel() {\n      router.push('/strategy');\n    };\n    var loadStrategy = /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var response;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              if (isEdit.value) {\n                _context2.next = 2;\n                break;\n              }\n              return _context2.abrupt(\"return\");\n            case 2:\n              _context2.prev = 2;\n              _context2.next = 5;\n              return strategyApi.getStrategy(route.params.id);\n            case 5:\n              response = _context2.sent;\n              form.value = response.data;\n              _context2.next = 13;\n              break;\n            case 9:\n              _context2.prev = 9;\n              _context2.t0 = _context2[\"catch\"](2);\n              ElMessage.error('加载策略失败：' + _context2.t0.message);\n              router.push('/strategy');\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[2, 9]]);\n      }));\n      return function loadStrategy() {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n    onMounted(function () {\n      loadStrategy();\n    });\n    var __returned__ = {\n      route: route,\n      router: router,\n      formRef: formRef,\n      form: form,\n      rules: rules,\n      isEdit: isEdit,\n      handleSave: handleSave,\n      cancel: cancel,\n      loadStrategy: loadStrategy,\n      ref: ref,\n      computed: computed,\n      onMounted: onMounted,\n      get useRoute() {\n        return useRoute;\n      },\n      get useRouter() {\n        return useRouter;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      MonacoEditor: MonacoEditor,\n      get strategyApi() {\n        return strategyApi;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","useRoute","useRouter","ElMessage","MonacoEditor","strategyApi","route","router","formRef","form","name","description","sqlCode","pythonCode","rules","required","message","trigger","min","max","isEdit","params","id","undefined","handleSave","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","value","abrupt","validate","updateStrategy","success","createStrategy","push","t0","error","stop","apply","arguments","cancel","loadStrategy","_ref3","_callee2","response","_callee2$","_context2","getStrategy","sent","data"],"sources":["/Users/guojingjing/2024-ai-code/crm/frontend/src/views/strategy/StrategyEdit.vue"],"sourcesContent":["<template>\n  <div class=\"strategy-edit\">\n    <div class=\"header\">\n      <h2>{{ isEdit ? '编辑策略' : '新建策略' }}</h2>\n    </div>\n    \n    <el-form :model=\"form\" label-width=\"120px\" :rules=\"rules\" ref=\"formRef\">\n      <el-form-item label=\"策略名称\" prop=\"name\">\n        <el-input v-model=\"form.name\" placeholder=\"请输入策略名称\" />\n      </el-form-item>\n      \n      <el-form-item label=\"策略描述\" prop=\"description\">\n        <el-input v-model=\"form.description\" type=\"textarea\" placeholder=\"请输入策略描述\" />\n      </el-form-item>\n      \n      <el-form-item label=\"SQL代码\" prop=\"sqlCode\">\n        <div class=\"editor-wrapper\">\n          <MonacoEditor\n            v-model=\"form.sqlCode\"\n            language=\"sql\"\n          />\n        </div>\n      </el-form-item>\n      \n      <el-form-item label=\"Python代码\" prop=\"pythonCode\">\n        <div class=\"editor-wrapper\">\n          <MonacoEditor\n            v-model=\"form.pythonCode\"\n            language=\"python\"\n          />\n        </div>\n      </el-form-item>\n      \n      <el-form-item>\n        <el-button type=\"primary\" @click=\"handleSave\">保存</el-button>\n        <el-button @click=\"cancel\">取消</el-button>\n      </el-form-item>\n    </el-form>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\nimport { ElMessage } from 'element-plus'\nimport MonacoEditor from '@/components/MonacoEditor.vue'\nimport { strategyApi } from '@/api/strategy'\n\nconst route = useRoute()\nconst router = useRouter()\nconst formRef = ref(null)\n\nconst form = ref({\n  name: '',\n  description: '',\n  sqlCode: '',\n  pythonCode: ''\n})\n\nconst rules = {\n  name: [\n    { required: true, message: '请输入策略名称', trigger: 'blur' },\n    { min: 2, max: 50, message: '长度在 2 到 50 个字符', trigger: 'blur' }\n  ],\n  description: [\n    { required: true, message: '请输入策略描述', trigger: 'blur' }\n  ],\n  sqlCode: [\n    { required: true, message: '请输入SQL代码', trigger: 'blur' }\n  ],\n  pythonCode: [\n    { required: true, message: '请输入Python代码', trigger: 'blur' }\n  ]\n}\n\nconst isEdit = computed(() => route.params.id !== undefined)\n\nconst handleSave = async () => {\n  if (!formRef.value) return\n  \n  try {\n    await formRef.value.validate()\n    \n    if (isEdit.value) {\n      await strategyApi.updateStrategy(route.params.id, form.value)\n      ElMessage.success('策略更新成功')\n    } else {\n      await strategyApi.createStrategy(form.value)\n      ElMessage.success('策略创建成功')\n    }\n    \n    router.push('/strategy')\n  } catch (error) {\n    if (error.name === 'ValidationError') {\n      ElMessage.error('请检查表单填写是否正确')\n    } else {\n      ElMessage.error('保存失败：' + error.message)\n    }\n  }\n}\n\nconst cancel = () => {\n  router.push('/strategy')\n}\n\nconst loadStrategy = async () => {\n  if (!isEdit.value) return\n  \n  try {\n    const response = await strategyApi.getStrategy(route.params.id)\n    form.value = response.data\n  } catch (error) {\n    ElMessage.error('加载策略失败：' + error.message)\n    router.push('/strategy')\n  }\n}\n\nonMounted(() => {\n  loadStrategy()\n})\n</script>\n\n<style>\n.strategy-edit {\n  padding: 20px;\n}\n\n.header {\n  margin-bottom: 20px;\n}\n\n.editor-wrapper {\n  height: 300px;\n  background-color: #1e1e1e;\n}\n</style>\n"],"mappings":";;;;;AA0CA,SAASA,GAAG,EAAEC,QAAQ,EAAEC,SAAS,QAAQ,KAAI;AAC7C,SAASC,QAAQ,EAAEC,SAAS,QAAQ,YAAW;AAC/C,SAASC,SAAS,QAAQ,cAAa;AACvC,OAAOC,YAAY,MAAM,+BAA8B;AACvD,SAASC,WAAW,QAAQ,gBAAe;;;;;;IAE3C,IAAMC,KAAK,GAAGL,QAAQ,CAAC;IACvB,IAAMM,MAAM,GAAGL,SAAS,CAAC;IACzB,IAAMM,OAAO,GAAGV,GAAG,CAAC,IAAI;IAExB,IAAMW,IAAI,GAAGX,GAAG,CAAC;MACfY,IAAI,EAAE,EAAE;MACRC,WAAW,EAAE,EAAE;MACfC,OAAO,EAAE,EAAE;MACXC,UAAU,EAAE;IACd,CAAC;IAED,IAAMC,KAAK,GAAG;MACZJ,IAAI,EAAE,CACJ;QAAEK,QAAQ,EAAE,IAAI;QAAEC,OAAO,EAAE,SAAS;QAAEC,OAAO,EAAE;MAAO,CAAC,EACvD;QAAEC,GAAG,EAAE,CAAC;QAAEC,GAAG,EAAE,EAAE;QAAEH,OAAO,EAAE,gBAAgB;QAAEC,OAAO,EAAE;MAAO,EAC/D;MACDN,WAAW,EAAE,CACX;QAAEI,QAAQ,EAAE,IAAI;QAAEC,OAAO,EAAE,SAAS;QAAEC,OAAO,EAAE;MAAO,EACvD;MACDL,OAAO,EAAE,CACP;QAAEG,QAAQ,EAAE,IAAI;QAAEC,OAAO,EAAE,UAAU;QAAEC,OAAO,EAAE;MAAO,EACxD;MACDJ,UAAU,EAAE,CACV;QAAEE,QAAQ,EAAE,IAAI;QAAEC,OAAO,EAAE,aAAa;QAAEC,OAAO,EAAE;MAAO;IAE9D;IAEA,IAAMG,MAAM,GAAGrB,QAAQ,CAAC;MAAA,OAAMO,KAAK,CAACe,MAAM,CAACC,EAAE,KAAKC,SAAS;IAAA;IAE3D,IAAMC,UAAU;MAAA,IAAAC,KAAA,GAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAC,QAAA;QAAA,OAAAF,mBAAA,GAAAG,IAAA,UAAAC,SAAAC,QAAA;UAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;YAAA;cAAA,IACZ1B,OAAO,CAAC2B,KAAK;gBAAAH,QAAA,CAAAE,IAAA;gBAAA;cAAA;cAAA,OAAAF,QAAA,CAAAI,MAAA;YAAA;cAAAJ,QAAA,CAAAC,IAAA;cAAAD,QAAA,CAAAE,IAAA;cAAA,OAGV1B,OAAO,CAAC2B,KAAK,CAACE,QAAQ,CAAC;YAAA;cAAA,KAEzBjB,MAAM,CAACe,KAAK;gBAAAH,QAAA,CAAAE,IAAA;gBAAA;cAAA;cAAAF,QAAA,CAAAE,IAAA;cAAA,OACR7B,WAAW,CAACiC,cAAc,CAAChC,KAAK,CAACe,MAAM,CAACC,EAAE,EAAEb,IAAI,CAAC0B,KAAK;YAAA;cAC5DhC,SAAS,CAACoC,OAAO,CAAC,QAAQ;cAAAP,QAAA,CAAAE,IAAA;cAAA;YAAA;cAAAF,QAAA,CAAAE,IAAA;cAAA,OAEpB7B,WAAW,CAACmC,cAAc,CAAC/B,IAAI,CAAC0B,KAAK;YAAA;cAC3ChC,SAAS,CAACoC,OAAO,CAAC,QAAQ;YAAA;cAG5BhC,MAAM,CAACkC,IAAI,CAAC,WAAW;cAAAT,QAAA,CAAAE,IAAA;cAAA;YAAA;cAAAF,QAAA,CAAAC,IAAA;cAAAD,QAAA,CAAAU,EAAA,GAAAV,QAAA;cAEvB,IAAIA,QAAA,CAAAU,EAAA,CAAMhC,IAAI,KAAK,iBAAiB,EAAE;gBACpCP,SAAS,CAACwC,KAAK,CAAC,aAAa;cAC/B,CAAC,MAAM;gBACLxC,SAAS,CAACwC,KAAK,CAAC,OAAO,GAAGX,QAAA,CAAAU,EAAA,CAAM1B,OAAO;cACzC;YAAA;YAAA;cAAA,OAAAgB,QAAA,CAAAY,IAAA;UAAA;QAAA,GAAAf,OAAA;MAAA,CAEJ;MAAA,gBAtBML,UAAUA,CAAA;QAAA,OAAAC,KAAA,CAAAoB,KAAA,OAAAC,SAAA;MAAA;IAAA,GAsBhB;IAEA,IAAMC,MAAM,GAAG,SAATA,MAAMA,CAAA,EAAS;MACnBxC,MAAM,CAACkC,IAAI,CAAC,WAAW;IACzB;IAEA,IAAMO,YAAY;MAAA,IAAAC,KAAA,GAAAvB,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAsB,SAAA;QAAA,IAAAC,QAAA;QAAA,OAAAxB,mBAAA,GAAAG,IAAA,UAAAsB,UAAAC,SAAA;UAAA,kBAAAA,SAAA,CAAApB,IAAA,GAAAoB,SAAA,CAAAnB,IAAA;YAAA;cAAA,IACdd,MAAM,CAACe,KAAK;gBAAAkB,SAAA,CAAAnB,IAAA;gBAAA;cAAA;cAAA,OAAAmB,SAAA,CAAAjB,MAAA;YAAA;cAAAiB,SAAA,CAAApB,IAAA;cAAAoB,SAAA,CAAAnB,IAAA;cAAA,OAGQ7B,WAAW,CAACiD,WAAW,CAAChD,KAAK,CAACe,MAAM,CAACC,EAAE;YAAA;cAAxD6B,QAAQ,GAAAE,SAAA,CAAAE,IAAA;cACd9C,IAAI,CAAC0B,KAAK,GAAGgB,QAAQ,CAACK,IAAG;cAAAH,SAAA,CAAAnB,IAAA;cAAA;YAAA;cAAAmB,SAAA,CAAApB,IAAA;cAAAoB,SAAA,CAAAX,EAAA,GAAAW,SAAA;cAEzBlD,SAAS,CAACwC,KAAK,CAAC,SAAS,GAAGU,SAAA,CAAAX,EAAA,CAAM1B,OAAO;cACzCT,MAAM,CAACkC,IAAI,CAAC,WAAW;YAAA;YAAA;cAAA,OAAAY,SAAA,CAAAT,IAAA;UAAA;QAAA,GAAAM,QAAA;MAAA,CAE3B;MAAA,gBAVMF,YAAYA,CAAA;QAAA,OAAAC,KAAA,CAAAJ,KAAA,OAAAC,SAAA;MAAA;IAAA,GAUlB;IAEA9C,SAAS,CAAC,YAAM;MACdgD,YAAY,CAAC;IACf,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}