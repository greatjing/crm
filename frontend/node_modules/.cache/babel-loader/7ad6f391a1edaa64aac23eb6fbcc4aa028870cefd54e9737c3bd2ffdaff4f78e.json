{"ast":null,"code":"import _regeneratorRuntime from \"/Users/guojingjing/2024-ai-code/crm/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/guojingjing/2024-ai-code/crm/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _objectSpread from \"/Users/guojingjing/2024-ai-code/crm/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.object.define-property.js\";\nimport { ref, computed, onMounted } from 'vue';\nimport { useRoute, useRouter } from 'vue-router';\nimport { ElMessage } from 'element-plus';\nimport MonacoEditor from '@/components/MonacoEditor.vue';\nimport { strategyApi } from '@/api/strategy';\nexport default {\n  __name: 'StrategyEdit',\n  setup: function setup(__props, _ref) {\n    var __expose = _ref.expose;\n    __expose();\n    var route = useRoute();\n    var router = useRouter();\n    var formRef = ref(null);\n    var form = ref({\n      name: '',\n      description: '',\n      sqlCode: '',\n      pythonCode: ''\n    });\n    var rules = {\n      name: [{\n        required: true,\n        message: '请输入策略名称',\n        trigger: 'blur'\n      }, {\n        min: 2,\n        max: 50,\n        message: '长度在 2 到 50 个字符',\n        trigger: 'blur'\n      }],\n      description: [{\n        required: true,\n        message: '请输入策略描述',\n        trigger: 'blur'\n      }],\n      sqlCode: [{\n        required: true,\n        message: '请输入SQL代码',\n        trigger: 'blur'\n      }],\n      pythonCode: [{\n        required: true,\n        message: '请输入Python代码',\n        trigger: 'blur'\n      }]\n    };\n    var commonEditorOptions = {\n      theme: 'vs-dark',\n      fontSize: 14,\n      minimap: {\n        enabled: false\n      },\n      scrollBeyondLastLine: false,\n      automaticLayout: true,\n      tabSize: 4,\n      formatOnPaste: true,\n      formatOnType: true,\n      contextmenu: true,\n      mouseWheelZoom: true,\n      quickSuggestions: {\n        other: true,\n        comments: true,\n        strings: true\n      },\n      renderControlCharacters: true,\n      renderLineHighlight: 'all',\n      scrollbar: {\n        vertical: 'visible',\n        horizontal: 'visible',\n        useShadows: true,\n        verticalHasArrows: true,\n        horizontalHasArrows: true\n      }\n    };\n    var sqlEditorOptions = _objectSpread(_objectSpread({}, commonEditorOptions), {}, {\n      language: 'sql'\n    });\n    var pythonEditorOptions = _objectSpread(_objectSpread({}, commonEditorOptions), {}, {\n      language: 'python'\n    });\n    var isEdit = computed(function () {\n      return route.params.id !== undefined;\n    });\n    var handleSave = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              if (formRef.value) {\n                _context.next = 2;\n                break;\n              }\n              return _context.abrupt(\"return\");\n            case 2:\n              _context.prev = 2;\n              _context.next = 5;\n              return formRef.value.validate();\n            case 5:\n              if (!isEdit.value) {\n                _context.next = 11;\n                break;\n              }\n              _context.next = 8;\n              return strategyApi.updateStrategy(route.params.id, form.value);\n            case 8:\n              ElMessage.success('策略更新成功');\n              _context.next = 14;\n              break;\n            case 11:\n              _context.next = 13;\n              return strategyApi.createStrategy(form.value);\n            case 13:\n              ElMessage.success('策略创建成功');\n            case 14:\n              router.push('/strategy');\n              _context.next = 20;\n              break;\n            case 17:\n              _context.prev = 17;\n              _context.t0 = _context[\"catch\"](2);\n              if (_context.t0.name === 'ValidationError') {\n                ElMessage.error('请检查表单填写是否正确');\n              } else {\n                ElMessage.error('保存失败：' + _context.t0.message);\n              }\n            case 20:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, null, [[2, 17]]);\n      }));\n      return function handleSave() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n    var cancel = function cancel() {\n      router.push('/strategy');\n    };\n    var loadStrategy = /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var response;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              if (isEdit.value) {\n                _context2.next = 2;\n                break;\n              }\n              return _context2.abrupt(\"return\");\n            case 2:\n              _context2.prev = 2;\n              _context2.next = 5;\n              return strategyApi.getStrategy(route.params.id);\n            case 5:\n              response = _context2.sent;\n              form.value = response.data;\n              _context2.next = 13;\n              break;\n            case 9:\n              _context2.prev = 9;\n              _context2.t0 = _context2[\"catch\"](2);\n              ElMessage.error('加载策略失败：' + _context2.t0.message);\n              router.push('/strategy');\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[2, 9]]);\n      }));\n      return function loadStrategy() {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n    onMounted(function () {\n      loadStrategy();\n    });\n    var __returned__ = {\n      route: route,\n      router: router,\n      formRef: formRef,\n      form: form,\n      rules: rules,\n      commonEditorOptions: commonEditorOptions,\n      sqlEditorOptions: sqlEditorOptions,\n      pythonEditorOptions: pythonEditorOptions,\n      isEdit: isEdit,\n      handleSave: handleSave,\n      cancel: cancel,\n      loadStrategy: loadStrategy,\n      ref: ref,\n      computed: computed,\n      onMounted: onMounted,\n      get useRoute() {\n        return useRoute;\n      },\n      get useRouter() {\n        return useRouter;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      MonacoEditor: MonacoEditor,\n      get strategyApi() {\n        return strategyApi;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","useRoute","useRouter","ElMessage","MonacoEditor","strategyApi","route","router","formRef","form","name","description","sqlCode","pythonCode","rules","required","message","trigger","min","max","commonEditorOptions","theme","fontSize","minimap","enabled","scrollBeyondLastLine","automaticLayout","tabSize","formatOnPaste","formatOnType","contextmenu","mouseWheelZoom","quickSuggestions","other","comments","strings","renderControlCharacters","renderLineHighlight","scrollbar","vertical","horizontal","useShadows","verticalHasArrows","horizontalHasArrows","sqlEditorOptions","_objectSpread","language","pythonEditorOptions","isEdit","params","id","undefined","handleSave","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","value","abrupt","validate","updateStrategy","success","createStrategy","push","t0","error","stop","apply","arguments","cancel","loadStrategy","_ref3","_callee2","response","_callee2$","_context2","getStrategy","sent","data"],"sources":["/Users/guojingjing/2024-ai-code/crm/frontend/src/views/strategy/StrategyEdit.vue"],"sourcesContent":["<template>\n  <div class=\"strategy-edit\">\n    <div class=\"header\">\n      <h2>{{ isEdit ? '编辑策略' : '新建策略' }}</h2>\n    </div>\n    \n    <el-form :model=\"form\" label-width=\"120px\" :rules=\"rules\" ref=\"formRef\">\n      <el-form-item label=\"策略名称\" prop=\"name\">\n        <el-input v-model=\"form.name\" placeholder=\"请输入策略名称\" />\n      </el-form-item>\n      \n      <el-form-item label=\"策略描述\" prop=\"description\">\n        <el-input v-model=\"form.description\" type=\"textarea\" placeholder=\"请输入策略描述\" />\n      </el-form-item>\n      \n      <el-form-item label=\"SQL代码\" prop=\"sqlCode\" class=\"code-editor-item\">\n        <div class=\"editor-outer-container\">\n          <div class=\"editor-container\">\n            <MonacoEditor\n              v-model=\"form.sqlCode\"\n              language=\"sql\"\n              :options=\"sqlEditorOptions\"\n              @save=\"handleSave\"\n            />\n          </div>\n        </div>\n        <div class=\"editor-tips\">\n          <el-tag size=\"small\" type=\"info\">输入 SELECT、INSERT 等关键字获取代码提示</el-tag>\n        </div>\n      </el-form-item>\n      \n      <el-form-item label=\"Python代码\" prop=\"pythonCode\" class=\"code-editor-item\">\n        <div class=\"editor-outer-container\">\n          <div class=\"editor-container\">\n            <MonacoEditor\n              v-model=\"form.pythonCode\"\n              language=\"python\"\n              :options=\"pythonEditorOptions\"\n              @save=\"handleSave\"\n            />\n          </div>\n        </div>\n        <div class=\"editor-tips\">\n          <el-tag size=\"small\" type=\"info\">输入 def、class 等关键字获取代码提示</el-tag>\n        </div>\n      </el-form-item>\n      \n      <el-form-item>\n        <el-button type=\"primary\" @click=\"handleSave\">保存</el-button>\n        <el-button @click=\"cancel\">取消</el-button>\n      </el-form-item>\n    </el-form>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\nimport { ElMessage } from 'element-plus'\nimport MonacoEditor from '@/components/MonacoEditor.vue'\nimport { strategyApi } from '@/api/strategy'\n\nconst route = useRoute()\nconst router = useRouter()\nconst formRef = ref(null)\n\nconst form = ref({\n  name: '',\n  description: '',\n  sqlCode: '',\n  pythonCode: ''\n})\n\nconst rules = {\n  name: [\n    { required: true, message: '请输入策略名称', trigger: 'blur' },\n    { min: 2, max: 50, message: '长度在 2 到 50 个字符', trigger: 'blur' }\n  ],\n  description: [\n    { required: true, message: '请输入策略描述', trigger: 'blur' }\n  ],\n  sqlCode: [\n    { required: true, message: '请输入SQL代码', trigger: 'blur' }\n  ],\n  pythonCode: [\n    { required: true, message: '请输入Python代码', trigger: 'blur' }\n  ]\n}\n\nconst commonEditorOptions = {\n  theme: 'vs-dark',\n  fontSize: 14,\n  minimap: { enabled: false },\n  scrollBeyondLastLine: false,\n  automaticLayout: true,\n  tabSize: 4,\n  formatOnPaste: true,\n  formatOnType: true,\n  contextmenu: true,\n  mouseWheelZoom: true,\n  quickSuggestions: {\n    other: true,\n    comments: true,\n    strings: true\n  },\n  renderControlCharacters: true,\n  renderLineHighlight: 'all',\n  scrollbar: {\n    vertical: 'visible',\n    horizontal: 'visible',\n    useShadows: true,\n    verticalHasArrows: true,\n    horizontalHasArrows: true\n  }\n}\n\nconst sqlEditorOptions = {\n  ...commonEditorOptions,\n  language: 'sql'\n}\n\nconst pythonEditorOptions = {\n  ...commonEditorOptions,\n  language: 'python'\n}\n\nconst isEdit = computed(() => route.params.id !== undefined)\n\nconst handleSave = async () => {\n  if (!formRef.value) return\n  \n  try {\n    await formRef.value.validate()\n    \n    if (isEdit.value) {\n      await strategyApi.updateStrategy(route.params.id, form.value)\n      ElMessage.success('策略更新成功')\n    } else {\n      await strategyApi.createStrategy(form.value)\n      ElMessage.success('策略创建成功')\n    }\n    \n    router.push('/strategy')\n  } catch (error) {\n    if (error.name === 'ValidationError') {\n      ElMessage.error('请检查表单填写是否正确')\n    } else {\n      ElMessage.error('保存失败：' + error.message)\n    }\n  }\n}\n\nconst cancel = () => {\n  router.push('/strategy')\n}\n\nconst loadStrategy = async () => {\n  if (!isEdit.value) return\n  \n  try {\n    const response = await strategyApi.getStrategy(route.params.id)\n    form.value = response.data\n  } catch (error) {\n    ElMessage.error('加载策略失败：' + error.message)\n    router.push('/strategy')\n  }\n}\n\nonMounted(() => {\n  loadStrategy()\n})\n</script>\n\n<style>\n.strategy-edit {\n  padding: 20px;\n}\n\n.header {\n  margin-bottom: 20px;\n}\n\n.code-editor-item :deep(.el-form-item__content) {\n  height: 320px;\n}\n\n.editor-outer-container {\n  border: 1px solid #dcdfe6;\n  border-radius: 4px;\n  height: 300px;\n  overflow: hidden;\n  background-color: #1e1e1e;\n}\n\n.editor-container {\n  height: 100%;\n  width: 100%;\n}\n\n.editor-tips {\n  margin-top: 8px;\n  display: flex;\n  gap: 8px;\n}\n\n.el-tag {\n  font-size: 12px;\n}\n\n/* 确保编辑器内容区域正确显示 */\n:deep(.monaco-editor) {\n  padding: 8px;\n  height: 100% !important;\n}\n\n:deep(.monaco-editor .overflow-guard) {\n  height: 100% !important;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}